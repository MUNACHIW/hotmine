{% load static %}
<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="shortcut icon" href="{% static 'hotmine/images/icon.png' %}" type="image/x-icon">
    <link rel="stylesheet" href="{% static 'hotmine/dashboard.css' %}" />
    <link rel="stylesheet" href="{% static 'hotmine/bootstrap-icons/bootstrap-icons.css' %}">
    <link rel="stylesheet" href="{% static 'hotmine/bootstrap.css' %}" />
    <title>Invest in Crypto Plan</title>
</head>

<body>
    <div class="overlay" id="overlay"></div>
    <div class="container-fluid">
        <div class="sidebar" id="sidebar">
            <img class="logo" src="{% static 'hotmine/images/miney.jpg' %}" alt="Hotmine Logo">
            <hr>
            <ul class="nav-links">
                <li><a href="/dashboard"><i class="bi bi-house"></i> Dashboard</a></li>
                <li><a href="/profile"><i class="bi bi-person"></i> User profile</a></li>
                <li class="active"><a href="/packages"><i class="bi bi-folder2-open"></i> Investment Plans</a></li>
                <li><a href="#"><i class="bi bi-folder2-open"></i> My Investment</a></li>
                <li><a href="#"><i class="bi bi-gear"></i> Buy</a></li>
                <li><a href="#"><i class="bi bi-box-arrow-right"></i> History</a></li>
                <li><a href="#"><i class="bi bi-box-arrow-right"></i> Downline</a></li>
                <li><a href="#"><i class="bi bi-box-arrow-right"></i> Change Password</a></li>
                <li><a href="#"><i class="bi bi-box-arrow-right"></i> Withdrawal</a></li>
                <li class="active"><a href="/logout"><i class="bi bi-box-arrow-right"></i> Logout</a></li>

            </ul>
        </div>
        <div class="tradingview-widget-container" id="mainContent">
            <div class="navbar d-flex justify-content-between align-items-center">
                <div class="d-flex align-items-center">

                    <h2 class="m-2">Investment Plans</h2>
                    <div id="google_translate_element"></div>
                </div>

                <div class="d-flex align-items-center dashaccount">
                    <span class="dashaccount"><a href="/profile">Account</a></span>
                    <span class="dashaccount"><a href="/logout">Log out</a></span>
                </div>
                <button class="menu-toggle" id="menuToggle">
                    <i class="bi bi-list"></i>
                </button>
            </div>
            <h2 style="font-size: 18px;">Send Crypto To the wallet address Below to Invest</h2>
            <section class="userdetails">
                <form method="POST" action="{% url 'invest' %}">
                    {% csrf_token %}
                    <label for="plan">Select Plan:</label>
                    <div class="w-100">
                        <select class="plan" name="plan" id="plan" required>
                            <option value="">-- Choose a Plan --</option>
                            {% for plan in plans %}
                            {% if plan == selected_plan %}
                            <option value="{{ plan }}" selected>{{ plan }}</option>
                            {% else %}
                            <option value="{{ plan }}">{{ plan }}</option>
                            {% endif %}
                            {% endfor %}
                        </select>
                    </div>

                    <label for="amount">Investment Amount (USD):</label>
                    <div>
                        <div>
                            <input class="plan" type="number" name="amount" id="amount" min="100" required><br>
                            <small id="amount-range">Minimum: $100</small>
                        </div>
                    </div>

                    <div>
                        <div>
                            <label for="wallet">Wallet Address:</label><br>
                            <input class="plan" type="text" name="wallet" id="wallet" readonly
                                placeholder="Select a plan to see wallet address">
                        </div>
                        <button class="colorbtn" type="button" id="copy-wallet" onclick="copyWalletAddress()" disabled>
                            <i class="bi bi-clipboard"></i> Copy Address
                        </button>
                    </div>

                    <small id="copy-feedback" style="color: green; display: none;">✓ Wallet address copied!</small>

                    <script>
                        const planSelect = document.getElementById('plan');
                        const walletInput = document.getElementById('wallet');
                        const copyButton = document.getElementById('copy-wallet');
                        const copyFeedback = document.getElementById('copy-feedback');

                        const walletAddresses = {
                            "Conservative Crypto Plan": "bc1qcefxxvxag8xu0gksp0cgtc8cfyve56dclxrvps", // BTC
                            "Balanced Growth Plan": "0x21b999ad1018e273649413a89aeA4598D6273a0d", // ETH
                            "Aggressive High-Yield Plan": "0x21b999ad1018e273649413a89aeA4598D6273a0d", // BNB
                            "Starter Portfolio": "bc1qcefxxvxag8xu0gksp0cgtc8cfyve56dclxrvps", // BTC
                            "Intermediate Portfolio": "0x21b999ad1018e273649413a89aeA4598D6273a0d", // ETH
                            "Advanced Portfolio": "0x21b999ad1018e273649413a89aeA4598D6273a0d", // BNB
                            "HODL Strategy": "bc1qcefxxvxag8xu0gksp0cgtc8cfyve56dclxrvps", // BTC
                            "Swing Trading Plan": "0x21b999ad1018e273649413a89aeA4598D6273a0d", // ETH
                            "Day Trading Plan": "0x21b999ad1018e273649413a89aeA4598D6273a0d", // BNB
                            "Stablecoin Income Plan": "0x21b999ad1018e273649413a89aeA4598D6273a0d", // TRC20
                            "NFT & Metaverse Plan": "0x21b999ad1018e273649413a89aeA4598D6273a0d", // ETH
                            "DeFi Power Plan": "0x21b999ad1018e273649413a89aeA4598D6273a0d" // ETH
                        };

                        const investmentRanges = {
                            "Conservative Crypto Plan": { min: 100, max: 500, text: "$100 - $500" },
                            "Balanced Growth Plan": { min: 500, max: 5000, text: "$500 - $5,000" },
                            "Aggressive High-Yield Plan": { min: 5000, max: null, text: "$5,000+" },
                            "Starter Portfolio": { min: 100, max: 500, text: "$100 - $500" },
                            "Intermediate Portfolio": { min: 500, max: 5000, text: "$500 - $5,000" },
                            "Advanced Portfolio": { min: 5000, max: null, text: "$5,000+" },
                            "HODL Strategy": { min: 100, max: null, text: "$100+" },
                            "Swing Trading Plan": { min: 100, max: null, text: "$100+" },
                            "Day Trading Plan": { min: 100, max: null, text: "$100+" },
                            "Stablecoin Income Plan": { min: 100, max: null, text: "$100+" },
                            "NFT & Metaverse Plan": { min: 100, max: null, text: "$100+" },
                            "DeFi Power Plan": { min: 100, max: null, text: "$100+" }
                        };


                        const menuToggle = document.getElementById('menuToggle');
                        const sidebar = document.getElementById('sidebar');
                        const overlay = document.getElementById('overlay');
                        const mainContent = document.getElementById('mainContent');

                        function toggleSidebar() {
                            if (window.innerWidth <= 768) {
                                sidebar.classList.toggle('show');
                                overlay.classList.toggle('show');
                            } else {
                                sidebar.classList.toggle('hidden');
                                mainContent.classList.toggle('full-width');
                            }
                        }

                        menuToggle.addEventListener('click', toggleSidebar);

                        overlay.addEventListener('click', () => {
                            sidebar.classList.remove('show');
                            overlay.classList.remove('show');
                        });

                        window.addEventListener('resize', () => {
                            if (window.innerWidth > 768) {
                                sidebar.classList.remove('show');
                                overlay.classList.remove('show');
                            }
                        });

                        function copyWalletAddress() {
                            const walletAddress = walletInput.value;
                            if (walletAddress && walletAddress !== "") {
                                navigator.clipboard.writeText(walletAddress).then(() => {
                                    copyFeedback.style.display = 'block';
                                    setTimeout(() => {
                                        copyFeedback.style.display = 'none';
                                    }, 2000);
                                }).catch(err => {
                                    // Fallback for older browsers
                                    walletInput.select();
                                    document.execCommand('copy');
                                    copyFeedback.textContent = '✓ Wallet address copied!';
                                    copyFeedback.style.display = 'block';
                                    setTimeout(() => {
                                        copyFeedback.style.display = 'none';
                                    }, 2000);
                                });
                            }
                        }

                        planSelect.addEventListener('change', function () {
                            const selectedPlan = this.value;
                            const amountInput = document.getElementById('amount');
                            const amountRange = document.getElementById('amount-range');

                            if (selectedPlan && walletAddresses[selectedPlan]) {
                                // Update wallet address
                                walletInput.value = walletAddresses[selectedPlan];
                                copyButton.disabled = false;

                                // Update investment range
                                if (investmentRanges[selectedPlan]) {
                                    const range = investmentRanges[selectedPlan];
                                    amountInput.min = range.min;
                                    if (range.max) {
                                        amountInput.max = range.max;
                                    } else {
                                        amountInput.removeAttribute('max');
                                    }
                                    amountRange.textContent = `Range: ${range.text}`;
                                    amountRange.style.color = '#6c757d';
                                }
                            } else {
                                walletInput.value = "";
                                walletInput.placeholder = "Select a plan to see wallet address";
                                copyButton.disabled = true;
                                amountInput.min = 100;
                                amountInput.removeAttribute('max');
                                amountRange.textContent = "Minimum: $100";
                                amountRange.style.color = '#6c757d';
                            }
                        });

                        // Validate amount on input
                        document.getElementById('amount').addEventListener('input', function () {
                            const selectedPlan = planSelect.value;
                            const amount = parseFloat(this.value);
                            const amountRange = document.getElementById('amount-range');

                            if (selectedPlan && investmentRanges[selectedPlan] && amount) {
                                const range = investmentRanges[selectedPlan];
                                if (amount < range.min) {
                                    amountRange.textContent = `⚠️ Minimum for this plan: ${range.min}`;
                                    amountRange.style.color = '#dc3545';
                                } else if (range.max && amount > range.max) {
                                    amountRange.textContent = `⚠️ Maximum for this plan: ${range.max}`;
                                    amountRange.style.color = '#dc3545';
                                } else {
                                    amountRange.textContent = `✓ Valid amount for ${range.text}`;
                                    amountRange.style.color = '#28a745';
                                }
                            }
                        });

                        // Set wallet address on page load if plan is pre-selected
                        if (planSelect.value && walletAddresses[planSelect.value]) {
                            walletInput.value = walletAddresses[planSelect.value];
                            copyButton.disabled = false;
                        }
                    </script>

                    <button class="submitbtn" type="submit">Submit Deposit</button>
                </form>
            </section>
        </div>
    </div>
</body>

</html>